name=fts-client
spec=./specs-client/fts-client.spec
version=${shell grep '^Version:' $(spec) | awk '{print $$2}' }
rpmbuild=${shell pwd}/rpmbuild
MOCKENV=epel-6-cernonly-x86_64
MOCKARGS=--verbose

rpmdefines=--define='_topdir ${rpmbuild}' \
	--define='_sourcedir %{_topdir}/SOURCES' \
	--define='_builddir %{_topdir}/BUILD' \
	--define='_srcrpmdir %{_topdir}/SRPMS' \
	--define='_rpmdir %{_topdir}/RPMS'

dist: clean
	tar --create --gzip --directory ../.. --file ./${name}-${version}.tar.gz --exclude=./packaging --exclude .svn --exclude .git .

clean:
	@rm -rf $(rpmbuild)
	@rm -f ${name}-${version}.tar.gz

prepare: dist
	@mkdir -p  $(rpmbuild)/RPMS/noarch
	@mkdir -p  $(rpmbuild)/SRPMS/
	@mkdir -p  $(rpmbuild)/SPECS/
	@mkdir -p  $(rpmbuild)/SOURCES/
	@mkdir -p  $(rpmbuild)/BUILD/
	mv ${name}-${version}.tar.gz $(rpmbuild)/SOURCES 

srpm: prepare $(spec)
	rpmbuild --nodeps -bs $(rpmdefines) $(spec)
	mv $(rpmbuild)/SRPMS/*.rpm .
	rm -r $(rpmbuild)

rpm: srpm
	rpmbuild --rebuild $(name)-$(version)-*.src.rpm 

mock: srpm
	/usr/bin/mock $(MOCKARGS) -r $(MOCKENV) $(name)-$(version)-*.src.rpm
