<IfModule !ssl_module>
  LoadModule ssl_module modules/mod_ssl.so
</IfModule>
<IfModule !wsgi_module>
    LoadModule wsgi_module modules/mod_wsgi.so
</IfModule>

# Monitoring in port 8449
Listen 8449
<VirtualHost *:8449>
    # SSL configuration
    SSLProtocol all -SSLv2
    SSLCipherSuite ALL:!ADH:!EXPORT:!SSLv2:RC4+RSA:+HIGH:+MEDIUM:+LOW
    SSLEngine On

    # Certificates
    SSLCertificateFile /etc/grid-security/hostcert.pem
    SSLCertificateKeyFile /etc/grid-security/hostkey.pem
    SSLCACertificatePath /etc/grid-security/certificates

    # Require client certificate
    #SSLVerifyClient require
    #SSLVerifyDepth  10

    # Django application
    WSGIScriptAlias /fts3 /usr/share/fts3web/fts3web.wsgi
    AllowEncodedSlashes On

    # Redirect to the monitoring webapp from the root
    RewriteEngine On
    RewriteRule ^/$ /fts3/ftsmon [R]
    RewriteRule ^/ftsmon/ /fts3/ftsmon [R]

    # Static content
    Alias /fts3/media /usr/share/fts3web/media
    <Location /media>
        SetOutputFilter DEFLATE
        ExpiresActive On
        ExpiresDefault "access plus 1 month"
    </Location>

    # FTS3 logs
    Alias /var/log/fts3 /var/log/fts3
    <Directory /var/log/fts3>
        Order allow,deny
        Allow from all
        SetOutputFilter DEFLATE
        ForceType text/plain
    </Directory>
</VirtualHost>

